{% extends "base.njk" %}

{% set title %}
{% if homes[property_id].building.bedrooms and homes[property_id].building.bedrooms > 0 %}
  {% if homes[property_id].rent.status == 'rent' %}{{ homes[property_id].building.property_type or 'Property' }} for Rent in {{ homes[property_id].address.city_name or homes[property_id].unormalized_address.city_name or '' }}, {{ homes[property_id].address.state_code or homes[property_id].unormalized_address.state_code or '' }} - {{ homes[property_id].building.bedrooms }} beds{% else %}{{ homes[property_id].building.property_type or 'Property' }} for Sale in {{ homes[property_id].address.city_name or homes[property_id].unormalized_address.city_name or '' }}, {{ homes[property_id].address.state_code or homes[property_id].unormalized_address.state_code or '' }} - {{ homes[property_id].building.bedrooms }} beds{% endif %}
{% else %}
  {{ homes[property_id].address.full_address or homes[property_id].unormalized_address.full_address or homes[property_id].address.street_address or 'Property' }}
{% endif %}
{% endset %}

{% set description %}
{% if homes[property_id].building.bedrooms and homes[property_id].building.bedrooms > 0 and homes[property_id].building.bathrooms and homes[property_id].building.bathrooms > 0 %}
  {% if homes[property_id].rent.status == 'rent' %}Rent this {{ homes[property_id].building.bedrooms }}-bed, {{ homes[property_id].building.bathrooms }}-bath property in {{ homes[property_id].address.city_name or homes[property_id].unormalized_address.city_name or '' }}, {{ homes[property_id].address.state_code or homes[property_id].unormalized_address.state_code or '' }}{% if homes[property_id].building.total_sqft or homes[property_id].building.living_sqft %}, {{ homes[property_id].building.total_sqft or homes[property_id].building.living_sqft }} sqft{% endif %}. {{ homes[property_id].address.full_address or homes[property_id].unormalized_address.full_address or 'this property' }}{% else %}{{ homes[property_id].building.bedrooms }}-bed, {{ homes[property_id].building.bathrooms }}-bath property for sale in {{ homes[property_id].address.city_name or homes[property_id].unormalized_address.city_name or '' }}, {{ homes[property_id].address.state_code or homes[property_id].unormalized_address.state_code or '' }}{% if homes[property_id].building.total_sqft or homes[property_id].building.living_sqft %}, {{ homes[property_id].building.total_sqft or homes[property_id].building.living_sqft }} sqft{% endif %}. {{ homes[property_id].address.full_address or homes[property_id].unormalized_address.full_address or 'this property' }}{% endif %}
{% else %}
  Property for sale in {% if homes[property_id].address.county_name %}{{ homes[property_id].address.county_name }} County{% elif homes[property_id].unormalized_address.county_jurisdiction %}{{ homes[property_id].unormalized_address.county_jurisdiction }}{% elif homes[property_id].address.street_address and 'palm beach' in (homes[property_id].address.street_address | lower) %}Palm Beach County{% else %}{{ homes[property_id].address.city_name or homes[property_id].unormalized_address.city_name or 'the area' }}{% endif %}
{% endif %}
{% endset %}

{% set canonical %}{{ config.domain }}/homes/{{ property_id }}{% endset %}
{% set og_url %}{{ config.domain }}/homes/{{ property_id }}{% endset %}
{% set twitter_url %}{{ config.domain }}/homes/{{ property_id }}{% endset %}

{% set og_title %}{{ title }}{% endset %}
{% set og_description %}{{ description }}{% endset %}
{% set twitter_title %}{{ title }}{% endset %}
{% set twitter_description %}{{ description }}{% endset %}

{% set content %}

<script>
// Section visibility configuration from backend
const sectionVisibility = {{ homes[property_id].sectionVisibility | json | safe }};

// Function to show/hide sections based on label
function updateSectionVisibility(label) {
  console.log('Updating section visibility for label:', label);
  
  if (!sectionVisibility || !sectionVisibility.label_to_div_mapping) {
    console.log('No section visibility configuration found');
    return;
  }
  
  const sections = sectionVisibility.label_to_div_mapping[label];
  if (!sections) {
    console.log('No sections found for label:', label);
    return;
  }
  
  console.log('Sections to show:', sections);
  
  // Hide all sections first
  document.querySelectorAll('[data-section]').forEach(section => {
    console.log('Hiding section:', section.id);
    section.classList.remove('show');
  });
  
  // Show only the sections for this label
  sections.forEach(sectionName => {
    const section = document.querySelector(`[data-section="${sectionName}"]`);
    if (section) {
      console.log('Showing section:', sectionName, 'element:', section);
      section.classList.add('show');
    } else {
      console.log('Section not found:', sectionName);
      // Debug: list all data-section elements
      const allSections = document.querySelectorAll('[data-section]');
      console.log('All data-section elements:', allSections);
    }
  });
}

         // Initialize with the label determined from the data
         document.addEventListener('DOMContentLoaded', function() {
           updateSectionVisibility('{{ homes[property_id].dataLabel or "Seed" }}');
         });
</script>

<a href="#main-content" style="position:absolute;left:-10000px;top:auto;width:1px;height:1px;overflow:hidden;">Skip to main content</a>


<!-- Navigation -->
<nav class="navigation">
    <div class="nav-content">
                    <div class="nav-tabs">
                {% set has_sales_data_nav = false %}
                {% for sale in homes[property_id].all_sales %}
                  {% if sale.data.purchase_price_amount %}
                    {% set has_sales_data_nav = true %}
                  {% endif %}
                {% endfor %}
                
                {% if has_sales_data_nav or (homes[property_id].all_taxes | length > 0) %}
                <a href="#property-history" class="nav-tab">Property History</a>
                {% endif %}
                
                {% set bedroom_count_nav = property_config[property_id].bedroom_count or 0 %}
                {% set bathroom_count_nav = property_config[property_id].bathroom_count or 0 %}
                {% set has_floorplan_data_nav = (bedroom_count_nav > 0) or (bathroom_count_nav > 0) or property_config[property_id].has_size_data %}
                
                {% if has_floorplan_data_nav %}
                <a href="#floorplan" class="nav-tab">Floorplan</a>
                {% endif %}
                
                <a href="#building-details" class="nav-tab">Building Details</a>
                
                {% set has_features_nav = false %}
                {% if homes[property_id].structure %}
                  {% if homes[property_id].structure.flooring_material_primary or homes[property_id].structure.flooring_material_secondary or homes[property_id].structure.exterior_wall_material_primary or homes[property_id].structure.roof_covering_material %}
                    {% set has_features_nav = true %}
                  {% endif %}
                {% endif %}
                {% if homes[property_id].utility %}
                  {% if homes[property_id].utility.cooling_system_type or homes[property_id].utility.heating_system_type %}
                    {% set has_features_nav = true %}
                  {% endif %}
                {% endif %}
                
                {% if has_features_nav %}
                <a href="#features" class="nav-tab">Property Features</a>
                {% endif %}
            </div>
            
            <!-- Condensed Providers (hidden by default) -->
            <div class="nav-providers-condensed" id="nav-providers-condensed">
                <div class="condensed-header">
                    <h4 class="condensed-title">Hire top rated providers</h4>
                </div>
                <div class="condensed-agent">
                    <div class="condensed-avatar">
                        <img src="{{ 'annette.jpg' | assetUrl }}" alt="Annette Santiago">
                    </div>
                    <div class="condensed-info">
                        <div class="condensed-name-row">
                            <img src="{{ 'type=real-estate-agent.svg' | assetUrl }}" alt="Real Estate Agent" class="condensed-icon">
                            <span class="condensed-name">Annette Santiago</span>
                        </div>
                        <div class="condensed-phone">561-202-7707</div>
                    </div>
                </div>
                <button class="view-all-providers-btn" id="view-all-providers-btn">
                    <span>View All Providers</span>
                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg" class="dropdown-icon">
                        <path d="M3 4.5L6 7.5L9 4.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
            
            <!-- Providers Overlay (hidden by default) -->
            <div class="providers-overlay" id="providers-overlay">
                <div class="providers-overlay-content">
                    <div class="providers-overlay-header">
                        <h3 class="providers-overlay-title">Hire top rated providers</h3>
                        <button class="close-overlay-btn" id="close-overlay-btn">Ã—</button>
                    </div>
                    <div class="providers-overlay-list">
                        <!-- This will be populated with the same provider content -->
                    </div>
                </div>
            </div>
    </div>
</nav>


<div class="container">
    <div class="main-layout" id="main-content">
        <!-- Main Content -->
        <div class="main-content">
            <!-- Header section wrapper for breadcrumb, carousel, and address -->
            <div class="header-section" data-section="header-section">
                <nav class="breadcrumb" aria-label="Breadcrumb">
                    <ol class="breadcrumb">
                        <li><a href="/" class="elephant-link">elephant.xyz</a></li>
                    </ol>
                </nav>

                <!-- Image Carousel -->
                {% if homes[property_id].carousel_images and homes[property_id].carousel_images | length > 0 %}
                <div class="carousel-container" id="photos">
                    {% for image in homes[property_id].carousel_images %}
                    <input type="radio" name="carousel-radio-{{ property_id }}" id="carousel-radio-{{ property_id }}-{{ loop.index }}" class="carousel-radio" {% if loop.first %}checked{% endif %}/>
                    {% endfor %}
                    
                    <div class="carousel-slides">
                        {% for image in homes[property_id].carousel_images %}
                        <div class="carousel-item">
                            {# Extract just the filename from ipfs_url for the assetUrl filter #}
                            {% set filename = image.ipfs_url | replace("./", "") %}
                            <img src="{{ filename | assetUrl(propertyImages) }}" alt="{{ image.name or 'Property Image' }}" class="carousel-image"
                                 loading="{% if loop.first %}eager{% else %}lazy{% endif %}" width="1120" height="615">
                        </div>
                        {% endfor %}
                    </div>

                    <div class="carousel-navigation">
                        <button class="carousel-arrow carousel-arrow-left" onclick="previousSlide('{{ property_id }}')" aria-label="Previous image">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                        <button class="carousel-arrow carousel-arrow-right" onclick="nextSlide('{{ property_id }}')" aria-label="Next image">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M9 6L15 12L9 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </div>
                </div>
                {% endif %}

                <!-- Property Header -->
                <header class="property-header" data-section="property-header">
                <div class="property-address" data-section="property-address">
                    <h1>
                        {% if homes[property_id].address %}
                            {% if homes[property_id].address.street_number %}{{ homes[property_id].address.street_number }}{% endif %}
                            {% if homes[property_id].address.street_pre_directional_text %}{{ homes[property_id].address.street_pre_directional_text }}{% endif %}
                            {% if homes[property_id].address.street_name %}{{ homes[property_id].address.street_name }}{% endif %}
                            {% if homes[property_id].address.street_suffix_type and (homes[property_id].address.street_suffix_type | lower | trim not in (homes[property_id].address.street_name | lower | trim)) %}{{ homes[property_id].address.street_suffix_type }}{% endif %}
                            {% if homes[property_id].address.street_post_directional_text %}{{ homes[property_id].address.street_post_directional_text }}{% endif %}
                            {% if homes[property_id].address.unit_identifier and homes[property_id].address.unit_identifier != 'NA' %}, {{ homes[property_id].address.unit_identifier }}{% endif %}
                            {% if homes[property_id].address.city_name %}, {{ homes[property_id].address.city_name }}{% endif %}
                            {% if homes[property_id].address.state_code %}, {{ homes[property_id].address.state_code }}{% endif %}
                            {% if homes[property_id].address.postal_code %} {{ homes[property_id].address.postal_code }}{% endif %}{% if homes[property_id].address.source_http_request %}<sup class="data-footnote"><a href="#addresssrc" style="color:inherit;text-decoration:none;">1</a></sup>{% endif %}
                        {% else %}
                            {{ homes[property_id].unormalized_address.full_address }}
                        {% endif %}
                    </h1>
                    
                    {% if homes[property_id].address %}
                        {% if homes[property_id].address.county_name or homes[property_id].address.latitude or homes[property_id].address.longitude or (homes[property_id].address.street_address and 'palm beach' in (homes[property_id].address.street_address | lower)) %}
                        <div class="location-details">
                            {% if homes[property_id].address.county_name %}
                            <span class="county-info">{{ homes[property_id].address.county_name }} County</span>
                            {% elif homes[property_id].address.street_address and 'palm beach' in (homes[property_id].address.street_address | lower) %}
                            <span class="county-info">Palm Beach County</span>
                            {% endif %}
                            {% if homes[property_id].address.county_name and (homes[property_id].address.latitude or homes[property_id].address.longitude) %}
                            <img src="{{ 'ellipse-7.svg' | assetUrl }}" alt="">
                            {% endif %}
                            {% if homes[property_id].address.latitude or homes[property_id].address.longitude %}
                            <span class="address-coordinates">
                                {% if homes[property_id].address.latitude %}{{ homes[property_id].address.latitude }}{% endif %}
                                {% if homes[property_id].address.longitude %}, {{ homes[property_id].address.longitude }}{% endif %}
                            </span>
                            {% endif %}
                        </div>
                        {% endif %}
                    {% endif %}
                    {% if homes[property_id].rent.status == 'rent' %}
                    <div class="status-badge">
                        <div class="status-dot"></div>
                        <span class="status-text">For Rent</span>
                    </div>
                    {% endif %}

                    {% if homes[property_id].rent.full_furnished %}
                    <div class="status-badge badge-furnished">
                        <img src="{{ 'type=living.svg' | assetUrl }}" alt="Fully Furnished" class="furnished-icon">
                        <span class="status-text">Fully Furnished</span>
                    </div>
                    {% endif %}
                </div>
            </header>
            </div>

            <!-- Property History Section -->
            {% set has_sales_data = false %}
            {% for sale in homes[property_id].all_sales %}
              {% if sale.data.purchase_price_amount %}
                {% set has_sales_data = true %}
              {% endif %}
            {% endfor %}
            
            {% if has_sales_data or (homes[property_id].all_taxes | length > 0) %}
                <section id="property-history" class="property-history-section scroll-offset-section" data-section="property-history">
                  <h2 class="section-title">Property History</h2>

                  <div class="property-history-data-points">
                {% set sales_count = 0 %}
                {% for sale in homes[property_id].all_sales %}
                  {% if sale.data.purchase_price_amount %}
                    {% set sales_count = sales_count + 1 %}
                    {% if sales_count <= 4 %}
                    <div class="history-sale">
                      <span class="history-price">${{ sale.data.purchase_price_amount | number }}</span> <span class="history-date-paren">(</span><span class="history-date">{%- if sale.data.ownership_transfer_date -%}{% set date_parts = sale.data.ownership_transfer_date.split('-') %}{% set month_num = date_parts[1] | int %}{% set year = date_parts[0] %}{% if month_num == 1 %}January{% elif month_num == 2 %}February{% elif month_num == 3 %}March{% elif month_num == 4 %}April{% elif month_num == 5 %}May{% elif month_num == 6 %}June{% elif month_num == 7 %}July{% elif month_num == 8 %}August{% elif month_num == 9 %}September{% elif month_num == 10 %}October{% elif month_num == 11 %}November{% elif month_num == 12 %}December{% endif %} {{ year }}{%- endif -%}</span><span class="history-date-paren">)</span>{% if sale.associatedEntity %}<span class="history-entity">{{ sale.associatedEntity.name }}</span>{% endif %}
                    </div>
                    {% endif %}
                  {% endif %}
                {% endfor %}
                
                <!-- Additional sale events (hidden by default) -->
                <div class="additional-sale-events" style="display: none;">
                  {% for sale in homes[property_id].all_sales %}
                    {% if sale.data.purchase_price_amount and loop.index > 4 %}
                    <div class="history-sale">
                      <span class="history-price">${{ sale.data.purchase_price_amount | number }}</span> <span class="history-date-paren">(</span><span class="history-date">{%- if sale.data.ownership_transfer_date -%}{% set date_parts = sale.data.ownership_transfer_date.split('-') %}{% set month_num = date_parts[1] | int %}{% set year = date_parts[0] %}{% if month_num == 1 %}January{% elif month_num == 2 %}February{% elif month_num == 3 %}March{% elif month_num == 4 %}April{% elif month_num == 5 %}May{% elif month_num == 6 %}June{% elif month_num == 7 %}July{% elif month_num == 8 %}August{% elif month_num == 9 %}September{% elif month_num == 10 %}October{% elif month_num == 11 %}November{% elif month_num == 12 %}December{% endif %} {{ year }}{%- endif -%}</span><span class="history-date-paren">)</span>{% if sale.associatedEntity %}<span class="history-entity">{{ sale.associatedEntity.name }}</span>{% endif %}
                    </div>
                    {% endif %}
                  {% endfor %}
                </div>
                
                <!-- Show More Button for Sale Events -->
                {% if homes[property_id].all_sales | length > 4 %}
                <button class="show-more-sales-btn" onclick="toggleMoreSalesData()">
                  <span>Show More Sale Events</span>
                  <img src="{{ 'type=carat-down.svg' | assetUrl }}" alt="Dropdown" class="provider-dropdown-arrow">
                </button>
                {% endif %}
                
                {% if homes[property_id].all_sales | length == 0 %}
                    <div class="history-sale">
                    <span class="history-price">No sales history available</span>
                    </div>
                {% endif %}
                  </div>
              
              <!-- Chart Tabs -->
              {% if (homes[property_id].all_sales | length > 1) or (homes[property_id].all_taxes | length >= 1) %}
              <div class="chart-tabs-container">
                <div class="chart-tabs">
                  {% if homes[property_id].all_sales | length > 1 %}
                  <button class="chart-tab active" data-tab="sales">
                    <span>Sale History</span>
                  </button>
                  {% endif %}
                  {% if homes[property_id].all_taxes | length >= 1 %}
                  <button class="chart-tab {% if homes[property_id].all_sales | length <= 1 %}active{% endif %}" data-tab="tax">
                    <span>Tax Information</span>
                  </button>
                  {% endif %}
                </div>
                
                <!-- Chart Content -->
                <div class="chart-content-container">
                  {% if homes[property_id].all_sales | length > 1 %}
                  <div id="sales-chart-content" class="chart-content active">
                    <div class="sales-chart-container">
                      <canvas id="salesPriceChart" width="400" height="200"></canvas>
                    </div>
                  </div>
                  {% endif %}
                  
                  {% if homes[property_id].all_taxes | length >= 1 %}
                  <div id="tax-chart-content" class="chart-content {% if homes[property_id].all_sales | length <= 1 %}active{% endif %}">
                    <div class="sales-chart-container">
                      <canvas id="taxAssessmentChart" width="400" height="200"></canvas>
                    </div>
                  </div>
                  {% endif %}
                </div>
              </div>
              {% endif %}
                </section>

                <!-- Tax Information Section -->
                <section id="tax-information" class="tax-information-section scroll-offset-section">
                  <h2 class="section-title">Tax Information</h2>
                  
              <!-- Initial Tax Year -->
              {% if homes[property_id].all_taxes | length > 0 %}
              {% set first_tax = homes[property_id].all_taxes[0].data %}
              <div class="tax-year-section">
                <h4 class="tax-year-header">Tax Year {{ first_tax.tax_year or 'N/A' }}</h4>
                    <div class="tax-data-points">
                      <!-- Property Assessed Value -->
                  {% if first_tax.property_assessed_value_amount %}
                      <div class="tax-data-item">
                        <div class="tax-item-divider"></div>
                        <div class="tax-item-content">
                          <span class="tax-label">Assessed Value:</span>
                      <span class="tax-value">${{ first_tax.property_assessed_value_amount | number }}</span>
                        </div>
                      </div>
                  {% endif %}
                      <!-- Property Market Value -->
                  {% if first_tax.property_market_value_amount %}
                      <div class="tax-data-item">
                        <div class="tax-item-divider"></div>
                        <div class="tax-item-content">
                          <span class="tax-label">Market Value:</span>
                      <span class="tax-value">${{ first_tax.property_market_value_amount | number }}</span>
                        </div>
                      </div>
                  {% endif %}
                      <!-- Property Building Amount -->
                  {% if first_tax.property_building_amount %}
                      <div class="tax-data-item">
                        <div class="tax-item-divider"></div>
                        <div class="tax-item-content">
                          <span class="tax-label">Building Value:</span>
                      <span class="tax-value">${{ first_tax.property_building_amount | number }}</span>
                        </div>
                      </div>
                  {% endif %}
                      <!-- Property Land Amount -->
                  {% if first_tax.property_land_amount %}
                      <div class="tax-data-item">
                        <div class="tax-item-divider"></div>
                        <div class="tax-item-content">
                          <span class="tax-label">Land Value:</span>
                      <span class="tax-value">${{ first_tax.property_land_amount | number }}</span>
                        </div>
                      </div>
                  {% endif %}
                      <!-- Property Taxable Value -->
                  {% if first_tax.property_taxable_value_amount %}
                      <div class="tax-data-item">
                        <div class="tax-item-divider"></div>
                        <div class="tax-item-content">
                          <span class="tax-label">Taxable Value:</span>
                      <span class="tax-value">${{ first_tax.property_taxable_value_amount | number }}</span>
                        </div>
                      </div>
                  {% endif %}
                      <!-- Monthly Tax Amount -->
                  {% if first_tax.monthly_tax_amount %}
                      <div class="tax-data-item">
                        <div class="tax-item-divider"></div>
                        <div class="tax-item-content">
                          <span class="tax-label">Monthly Tax:</span>
                      <span class="tax-value">${{ first_tax.monthly_tax_amount | number }}</span>
                        </div>
                      </div>
                  {% endif %}
                      <!-- Tax Period -->
                  {% if first_tax.period_start_date or first_tax.period_end_date %}
                      <div class="tax-data-item">
                        <div class="tax-item-divider"></div>
                        <div class="tax-item-content">
                          <span class="tax-label">Tax Period:</span>
                      <span class="tax-value">{{ first_tax.period_start_date or '' }} - {{ first_tax.period_end_date or '' }}</span>
                        </div>
                      </div>
                  {% endif %}
                    </div>
                  </div>
              {% endif %}

              <!-- Show More Button -->
              {% if homes[property_id].all_taxes | length > 1 %}
              <button class="show-more-tax-btn" onclick="toggleMoreTaxData()">
                <span>Show More Tax Years</span>
                <img src="{{ 'type=carat-down.svg' | assetUrl }}" alt="Dropdown" class="provider-dropdown-arrow">
              </button>
              {% endif %}

              <!-- Additional Tax Years (Hidden by default) -->
              <div class="additional-tax-years" style="display: none;">
                {% for tax in homes[property_id].all_taxes %}
                  {% if loop.index > 1 %}
                  <div class="tax-year-section">
                    <h4 class="tax-year-header">Tax Year {{ tax.data.tax_year or 'N/A' }}</h4>
                    <div class="tax-data-points">
                      {% if tax.data.property_assessed_value_amount %}
                      <div class="tax-data-item">
                        <div class="tax-item-divider"></div>
                        <div class="tax-item-content">
                          <span class="tax-label">Assessed Value:</span>
                          <span class="tax-value">${{ tax.data.property_assessed_value_amount | number }}</span>
                        </div>
                      </div>
                      {% endif %}
                      {% if tax.data.property_market_value_amount %}
                      <div class="tax-data-item">
                        <div class="tax-item-divider"></div>
                        <div class="tax-item-content">
                          <span class="tax-label">Market Value:</span>
                          <span class="tax-value">${{ tax.data.property_market_value_amount | number }}</span>
                        </div>
                      </div>
                      {% endif %}
                      {% if tax.data.property_building_amount %}
                      <div class="tax-data-item">
                        <div class="tax-item-divider"></div>
                        <div class="tax-item-content">
                          <span class="tax-label">Building Value:</span>
                          <span class="tax-value">${{ tax.data.property_building_amount | number }}</span>
                        </div>
                      </div>
                      {% endif %}
                      {% if tax.data.property_land_amount %}
                      <div class="tax-data-item">
                        <div class="tax-item-divider"></div>
                        <div class="tax-item-content">
                          <span class="tax-label">Land Value:</span>
                          <span class="tax-value">${{ tax.data.property_land_amount | number }}</span>
                        </div>
                      </div>
                      {% endif %}
                      {% if tax.data.property_taxable_value_amount %}
                      <div class="tax-data-item">
                        <div class="tax-item-divider"></div>
                        <div class="tax-item-content">
                          <span class="tax-label">Taxable Value:</span>
                          <span class="tax-value">${{ tax.data.property_taxable_value_amount | number }}</span>
                        </div>
                      </div>
                      {% endif %}
                      {% if tax.data.monthly_tax_amount %}
                      <div class="tax-data-item">
                        <div class="tax-item-divider"></div>
                        <div class="tax-item-content">
                          <span class="tax-label">Monthly Tax:</span>
                          <span class="tax-value">${{ tax.data.monthly_tax_amount | number }}</span>
                        </div>
                      </div>
                      {% endif %}
                      {% if tax.data.period_start_date or tax.data.period_end_date %}
                      <div class="tax-data-item">
                        <div class="tax-item-divider"></div>
                        <div class="tax-item-content">
                          <span class="tax-label">Tax Period:</span>
                          <span class="tax-value">{{ tax.data.period_start_date or '' }} - {{ tax.data.period_end_date or '' }}</span>
                        </div>
                      </div>
                      {% endif %}
                    </div>
                  </div>
                  {% endif %}
                {% endfor %}

                <!-- Tax Year 3 -->
                {% if homes[property_id].tax_3 %}
                <div class="tax-year-section">
                  <h4 class="tax-year-header">Tax Year {{ homes[property_id].tax_3.tax_year or 'N/A' }}</h4>
                  <div class="tax-data-points">
                    {% if homes[property_id].tax_3.property_assessed_value_amount %}
                    <div class="tax-data-item">
                      <div class="tax-item-divider"></div>
                      <div class="tax-item-content">
                        <span class="tax-label">Assessed Value:</span>
                        <span class="tax-value">${{ homes[property_id].tax_3.property_assessed_value_amount | number }}</span>
                      </div>
                    </div>
                    {% endif %}
                    {% if homes[property_id].tax_3.property_market_value_amount %}
                    <div class="tax-data-item">
                      <div class="tax-item-divider"></div>
                      <div class="tax-item-content">
                        <span class="tax-label">Market Value:</span>
                        <span class="tax-value">${{ homes[property_id].tax_3.property_market_value_amount | number }}</span>
                      </div>
                    </div>
                    {% endif %}
                    {% if homes[property_id].tax_3.property_building_amount %}
                    <div class="tax-data-item">
                      <div class="tax-item-divider"></div>
                      <div class="tax-item-content">
                        <span class="tax-label">Building Value:</span>
                        <span class="tax-value">${{ homes[property_id].tax_3.property_building_amount | number }}</span>
                      </div>
                    </div>
                    {% endif %}
                    {% if homes[property_id].tax_3.property_land_amount %}
                    <div class="tax-data-item">
                      <div class="tax-item-divider"></div>
                      <div class="tax-item-content">
                        <span class="tax-label">Land Value:</span>
                        <span class="tax-value">${{ homes[property_id].tax_3.property_land_amount | number }}</span>
                      </div>
                    </div>
                    {% endif %}
                    {% if homes[property_id].tax_3.property_taxable_value_amount %}
                    <div class="tax-data-item">
                      <div class="tax-item-divider"></div>
                      <div class="tax-item-content">
                        <span class="tax-label">Taxable Value:</span>
                        <span class="tax-value">${{ homes[property_id].tax_3.property_taxable_value_amount | number }}</span>
                      </div>
                    </div>
                    {% endif %}
                    {% if homes[property_id].tax_3.monthly_tax_amount %}
                    <div class="tax-data-item">
                      <div class="tax-item-divider"></div>
                      <div class="tax-item-content">
                        <span class="tax-label">Monthly Tax:</span>
                        <span class="tax-value">${{ homes[property_id].tax_3.monthly_tax_amount | number }}</span>
                      </div>
                    </div>
                    {% endif %}
                    {% if homes[property_id].tax_3.period_start_date or homes[property_id].tax_3.period_end_date %}
                    <div class="tax-data-item">
                      <div class="tax-item-divider"></div>
                      <div class="tax-item-content">
                        <span class="tax-label">Tax Period:</span>
                        <span class="tax-value">{{ homes[property_id].tax_3.period_start_date or '' }} - {{ homes[property_id].tax_3.period_end_date or '' }}</span>
                      </div>
                    </div>
                    {% endif %}
                  </div>
                </div>
                {% endif %}


              </div>

                  <!-- Tax Authority Subsection -->
              {% if homes[property_id].tax_1.authority_name or homes[property_id].tax_1.authority_account_identifier or homes[property_id].tax_1.authority_category %}
                  <div class="tax-subsection">
                    <h3 class="tax-subsection-title">Tax Authority</h3>
                    <div class="tax-data-points">
                      <!-- Tax Authority Name -->
                  {% if homes[property_id].tax_1.authority_name %}
                      <div class="tax-data-item">
                        <div class="tax-item-divider"></div>
                        <div class="tax-item-content">
                          <span class="tax-label">Authority Name:</span>
                      <span class="tax-value">{{ homes[property_id].tax_1.authority_name }}</span>
                        </div>
                      </div>
                  {% endif %}
                      <!-- Tax Authority Account -->
                  {% if homes[property_id].tax_1.authority_account_identifier %}
                      <div class="tax-data-item">
                        <div class="tax-item-divider"></div>
                        <div class="tax-item-content">
                          <span class="tax-label">Account ID:</span>
                      <span class="tax-value">{{ homes[property_id].tax_1.authority_account_identifier }}</span>
                        </div>
                      </div>
                  {% endif %}
                      <!-- Tax Authority Category -->
                  {% if homes[property_id].tax_1.authority_category %}
                      <div class="tax-data-item">
                        <div class="tax-item-divider"></div>
                        <div class="tax-item-content">
                          <span class="tax-label">Authority Category:</span>
                      <span class="tax-value">{{ homes[property_id].tax_1.authority_category }}</span>
                        </div>
                      </div>
                  {% endif %}
                    </div>
                </div>
              {% endif %}

                  <!-- Tax Exemptions Subsection -->
              {% if homes[property_id].tax_1.property_exemption_type or homes[property_id].tax_1.property_exemption_amount %}
                  <div class="tax-subsection">
                    <h3 class="tax-subsection-title">Tax Exemptions</h3>
                    <div class="tax-data-points">
                      <!-- Tax Exemption Type -->
                  {% if homes[property_id].tax_1.property_exemption_type %}
                      <div class="tax-data-item">
                        <div class="tax-item-divider"></div>
                        <div class="tax-item-content">
                          <span class="tax-label">Exemption Type:</span>
                      <span class="tax-value">{{ homes[property_id].tax_1.property_exemption_type }}</span>
                        </div>
                      </div>
                  {% endif %}
                      <!-- Tax Exemption Value -->
                  {% if homes[property_id].tax_1.property_exemption_amount %}
                      <div class="tax-data-item">
                        <div class="tax-item-divider"></div>
                        <div class="tax-item-content">
                          <span class="tax-label">Exemption Value:</span>
                      <span class="tax-value">${{ homes[property_id].tax_1.property_exemption_amount | number }}</span>
                        </div>
                      </div>
                        {% endif %}
                    </div>
                </div>
                    {% endif %}
                </section>
            {% endif %}

            <!-- Add your content sections here -->
            
            <!-- Floorplan -->
            {% set bedroom_count = property_config[property_id].bedroom_count or 0 %}
            {% set bathroom_count = property_config[property_id].bathroom_count or 0 %}
            {% set has_floorplan_data = (bedroom_count > 0) or (bathroom_count > 0) or property_config[property_id].has_size_data %}
            
            {% if has_floorplan_data %}
            <div id="floorplan" class="section scroll-offset-section" data-section="floorplan">
                <div class="floorplan-header">
                    <h2 class="section-title">Floorplan</h2>
                </div>
                <div class="floorplan-info">
                    <div class="floorplan-specs">
                        <img src="{{ 'featuresicons.svg' | assetUrl }}" alt="Bed Icon" class="icon">
                        {# Bedroom/Bathroom counts precomputed in property_config.json #}
                        {% set bedroom_count = property_config[property_id].bedroom_count or 0 %}
                        {% set bathroom_count = property_config[property_id].bathroom_count or 0 %}
                        {% set has_size_data = property_config[property_id].has_size_data %}
                        {% set total_sqft = property_config[property_id].total_sqft %}
                        
                        <span>{% if bedroom_count > 0 %}{{ bedroom_count | int }} Beds{% else %}Beds unknown{% endif %}</span>
                        <img src="{{ 'ellipse-7.svg' | assetUrl }}" alt="">
                        <span>{% if bathroom_count > 0 %}{{ bathroom_count }} Baths{% else %}Baths unknown{% endif %}</span>
                        {% if has_size_data %}
                        <img src="{{ 'ellipse-7.svg' | assetUrl }}" alt="">
                        <span>{{ total_sqft | number }} sqft</span>
                        {% endif %}
                    </div>
                    <div class="floorplan-description">
                        {% if bedroom_count > 0 and bathroom_count > 0 %}
                            {{ bedroom_count | int }}-bedroom, {{ bathroom_count }}-bathroom property
                        {% elif bedroom_count > 0 %}
                            {{ bedroom_count | int }}-bedroom property
                        {% elif bathroom_count > 0 %}
                            {{ bathroom_count }}-bathroom property
                        {% else %}
                            Property layout details
                        {% endif %}
                </div>
                </div>
                
                <!-- Property Type and Units Info -->
                {% if homes[property_id].property.property_type %}
                <div class="property-type-info">
                    <span class="property-type-value">{{ homes[property_id].property.property_type | replace('_', ' ') }}</span>
                    {% if homes[property_id].property.number_of_units_type and homes[property_id].property.number_of_units_type != 'null' %}, <span class="property-type-value">
                        {% if homes[property_id].property.number_of_units_type == 'One' %}One Unit{% elif homes[property_id].property.number_of_units_type == 'Two' %}Two Units{% elif homes[property_id].property.number_of_units_type == 'Three' %}Three Units{% elif homes[property_id].property.number_of_units_type == 'Four' %}Four Units{% else %}{{ homes[property_id].property.number_of_units_type }} Units{% endif %}
                    </span>{% endif %}
                </div>
                {% endif %}
                
                {# Group all layout rooms by floor level #}
                {% set all_layouts = homes[property_id].layouts or [] %}
                {% set first_floor_rooms = all_layouts.firstFloorLayouts %}
                {% set second_floor_rooms = all_layouts.secondFloorLayouts %}
                {% set other_rooms = all_layouts.otherLayouts %}
                {% macro floorRooms(roomList) %}
                  <div class="floor-rooms collapsible-content">
                    {% for room in roomList %}
                      {% set roomProperties = [] %}
                      {% for key, value in room %}
                        {% if key != 'space_type' and key != 'floor_level' %}
                          {% set roomProperties = (roomProperties.push(value), roomProperties) %}
                        {% endif %}
                      {% endfor %}
                      
                      <div class="room-item collapbsible">
                            {% if roomProperties | length > 0 %}
                            <div class="room-header" onclick="toggleRoomDetails(this)">
                                <div class="room-icon-container">
                                    {% if room.space_type.iconName %}
                                        <img src="{{ room.space_type.iconName | assetUrl}}" alt="">
                                    {% endif %}
                                </div>
                                <span class="room-title">{{ room.space_type.enumDescription or 'Room' }}</span>
                                <img src="{{ 'uiicons-1.svg' | assetUrl }}" alt="Expand" class="room-expand-icon">
                            </div>
                            <ul class="room-properties" style="display: none;">
                            {% for key, value in room %}
                              {% if key != 'space_type' and key != 'floor_level' %} 
                                <li>{% if value.iconName %}<img src="{{ value.iconName | assetUrl}}" alt="{{ value.enumDescription }}" class="room-property-icon"> {% endif %} {{ value.enumDescription }} </li>
                              {% endif %}
                            {% endfor %}
                            </ul>
                            {% else %}
                            <div class="room-header">
                                <div class="room-icon-container">
                                    {% if room.space_type.iconName %}
                                        <img src="{{ room.space_type.iconName | assetUrl}}" alt="">
                                    {% endif %}
                                </div>
                                <span class="room-title">{{ room.space_type.enumDescription or 'Room' }}</span>
                            </div>
                            {% endif %}
                      </div>
                    {% endfor %}
                  </div>
                {% endmacro %}

                {% if (first_floor_rooms | length > 0 and first_floor_rooms | selectattr('space_type') | list | length > 0) or (second_floor_rooms | length > 0 and second_floor_rooms | selectattr('space_type') | list | length > 0) or (other_rooms | length > 0 and other_rooms | selectattr('space_type') | list | length > 0) %}
                <div class="floorplan-layout" data-section="floorplan-layout">
                  <div class="floorplan-floors">
                    <!-- 1st Floor -->
                    {% if first_floor_rooms | length > 0 and first_floor_rooms | selectattr('space_type') | list | length > 0 %}
                    <div class="floor-section">
                        <div class="floor-header">
                            <img src="{{ 'featuresicons-13.svg' | assetUrl }}" alt="1st Floor" class="floor-header-icon">
                            <h3 class="section-subtitle">1st Floor</h3>
                        </div>
                        {{ floorRooms(first_floor_rooms) }}
                    </div>
                    {% endif %}
                    
                    <!-- 2nd Floor -->
                    {% if second_floor_rooms | length > 0 and second_floor_rooms | selectattr('space_type') | list | length > 0 %}
                    <div class="floor-section">
                        <div class="floor-header">
                            <img src="{{ 'featuresicons-5.svg' | assetUrl }}" alt="2nd Floor" class="floor-header-icon">
                            <h3 class="section-subtitle">2nd Floor</h3>
                        </div>
                        {{ floorRooms(second_floor_rooms) }}
                    </div>
                    {% endif %}
                    
                    <!-- Other Rooms -->
                    {% if other_rooms | length > 0 and other_rooms | selectattr('space_type') | list | length > 0 %}
                    <div class="floor-section">
                        <div class="floor-header">
                            <img src="{{ 'featuresicons-33.svg' | assetUrl }}" alt="Other Rooms" class="floor-header-icon">
                            <h3 class="section-subtitle">Other Rooms</h3>
                        </div>
                        {{ floorRooms(other_rooms) }}
                    </div>
                    {% endif %}
                  </div>
                </div>
                {% endif %}
            </div>
            {% endif %}
            <!-- Building Details -->
            <section id="building-details" class="building-details-section scroll-offset-section" data-section="building-details">
              {% set has_substantial_building_data = false %}
              {% if homes[property_id].property.property_structure_built_year or homes[property_id].property.builder_name %}
                {% set has_substantial_building_data = true %}
              {% endif %}
              {% if homes[property_id].property.property_legal_description_text and homes[property_id].property.property_legal_description_text != 'null' %}
                {% set has_substantial_building_data = true %}
              {% endif %}
              {% if homes[property_id].property.livable_floor_area > 0 %}
                {% set has_substantial_building_data = true %}
              {% endif %}
              {% if homes[property_id].lot and homes[property_id].lot.lot_type and homes[property_id].lot.lot_type != 'null' %}
                {% set has_substantial_building_data = true %}
              {% endif %}
              {% if homes[property_id].lot and homes[property_id].lot.lot_area_sqft %}
                {% set has_substantial_building_data = true %}
              {% endif %}
              {% if homes[property_id].lot and (homes[property_id].lot.lot_width_feet or homes[property_id].lot.lot_length_feet) %}
                {% set has_substantial_building_data = true %}
              {% endif %}
              
              {% if has_substantial_building_data %}
              <h2 class="section-title">Building Details</h2>
              {% endif %}
                <div class="building-details-content">
                    <div class="building-details-grid">
                        <!-- First Column -->
                        <div class="building-details-column">
                            <!-- Year Built -->
                            {% if homes[property_id].property.property_structure_built_year or homes[property_id].property.builder_name %}
                            <div class="building-spec-item">
                                <div class="building-spec-label">Year Built</div>
                                <div class="building-spec-value">
                                    <div class="building-spec-text">{{ homes[property_id].property.property_structure_built_year or 'Unknown' }}</div>
                                    {% if homes[property_id].property.builder_name %}
                                    <div class="building-spec-text">{{ homes[property_id].property.builder_name }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            {% endif %}
                            
                            <!-- Legal Description -->
                            {% if homes[property_id].property.property_legal_description_text and homes[property_id].property.property_legal_description_text != 'null' %}
                            <div class="building-spec-item">
                                <div class="building-spec-label">Legal Description</div>
                                <div class="building-spec-value">
                                    <div class="building-spec-text">{{ homes[property_id].property.property_legal_description_text | trim }}</div>
                                </div>
                            </div>
                            {% endif %}
                            
                            <!-- Parcel ID -->
                            {% if homes[property_id].property.parcel_identifier or property_id %}
                            <div class="building-spec-item">
                                <div class="building-spec-label">Parcel ID (APN)</div>
                                <div class="building-spec-value">
                                    <div class="building-spec-text">{{ homes[property_id].property.parcel_identifier or property_id }}</div>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                        
                        <!-- Second Column -->
                        <div class="building-details-column">
                            <!-- Living Area -->
                            {% if homes[property_id].property.livable_floor_area > 0 %}
                            <div class="building-spec-item">
                                <div class="building-spec-label">Living Area</div>
                                <div class="building-spec-value">
                                    <div class="building-spec-text">{{ homes[property_id].property.livable_floor_area | number }} sqft</div>
                                </div>
                            </div>
                            {% endif %}
                            
                            <!-- Lot Type -->
                            {% if homes[property_id].lot and homes[property_id].lot.lot_type and homes[property_id].lot.lot_type != 'null' %}
                            <div class="building-spec-item">
                                <div class="building-spec-label">Lot Type</div>
                                <div class="building-spec-value">
                                    <div class="building-spec-text">
                                        {% if homes[property_id].lot.lot_type == 'LessThanOrEqualToOneQuarterAcre' %}
                                            Less than or equal to 1/4 acre
                                        {% elif homes[property_id].lot.lot_type == 'GreaterThanOneQuarterAcre' %}
                                            Greater than 1/4 acre
                                        {% else %}
                                            {{ homes[property_id].lot.lot_type | replace('_', ' ') }}
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                            
                            <!-- Lot Area -->
                            {% if homes[property_id].lot and homes[property_id].lot.lot_area_sqft %}
                            <div class="building-spec-item">
                                <div class="building-spec-label">Lot Area</div>
                                <div class="building-spec-value">
                                    <div class="building-spec-text">{{ homes[property_id].lot.lot_area_sqft | number }} sqft</div>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Additional lot size info (if available) -->
                    {% if homes[property_id].lot and (homes[property_id].lot.lot_width_feet or homes[property_id].lot.lot_length_feet) %}
                    <div class="building-specifications">
                        <div class="building-spec-item">
                            <div class="building-spec-label">Lot Size</div>
                            <div class="building-spec-value">
                                {% if homes[property_id].lot.lot_width_feet %}
                                <div class="building-spec-text">Width: {{ homes[property_id].lot.lot_width_feet | number }}'</div>
                                {% endif %}
                                {% if homes[property_id].lot.lot_length_feet %}
                                <div class="building-spec-text">Length: {{ homes[property_id].lot.lot_length_feet | number }}'</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </section>

            <!-- Utility Systems -->
            <!-- Property Features -->
            {% set interior_features = homes[property_id].features.interior %}
            {% set exterior_features = homes[property_id].features.exterior %}
            {% set utilities = homes[property_id].utility %}

            {% macro renderFeature(features) %}
              <div class="features-list">
                  {% for feature in features %}
                  <div class="feature-item-detailed">
                      <div class="feature-row">
                        {% set iconPath = feature.iconName %}
                        {% if iconPath %}
                          <img src="{{ iconPath | assetUrl }}" alt="{{ feature.info.description }}">
                        {% endif %}
                        <div class="feature-text-content">
                            <div class="feature-main-text">{{ feature.enumDescription }}</div>
                        </div>
                      </div>
                  </div>
                  {% endfor %}
              </div>
            {% endmacro %}
            
            {% if interior_features | length > 0 or exterior_features | length > 0 or utilities is defined %}
            <section class="section" id="features" data-section="features">
                <h2 class="section-title">Property Features</h2>
                <div class="features-container">
                    <div class="features-grid">
                        <!-- Interior Features -->
                        {% if interior_features | length > 0 %}
                        <div class="features-section">
                            <h3 class="section-subtitle">Interior</h3>
                            {{ renderFeature(interior_features) }}
                        </div>
                        {% endif %}

                        <!-- Exterior Features -->
                        {% if exterior_features | length > 0  %}
                        <div class="features-section">
                            <h3 class="section-subtitle">Exterior</h3>
                            {{ renderFeature(exterior_features) }}
                        </div>
                        {% endif %}

                        <!-- Utility Systems -->
                        {% if utilities is defined %}
                        <div class="features-section">
                            <h3 class="section-subtitle">Utility Systems</h3>
                            <div class="features-list">
                                {% for key, util in utilities %}
                                <div class="feature-item-detailed">
                                    <div class="feature-row">
                                      {% set iconPath = util.iconName %}
                                      {% if iconPath %}
                                        <img src="{{ iconPath | assetUrl }}" alt="{{ util.enumDescription }}">
                                      {% endif %}
                                      <div class="feature-text-content">
                                          <div class="feature-main-text">{{ util.enumDescription }}</div>
                                      </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </section>
            {% endif %}

        </div>
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-content">
                <!-- Rental Price Card -->
                <div class="price-card">
                    <div class="price-header">
                        <div class="price-icon">
                            <span class="dollar-sign">$</span>
                        </div>
                        <span class="price-label">Last Sale Price</span>
                    </div>
                    <div class="price-amount">${{ sales_history[0].amount | number }}</div>

                    <!-- Expanded Content (Always Visible) -->
                    <div class="expanded-content">
                        <div class="tax-assessment-section">
                            <div class="expanded-content-label">Tax Assessment</div>
                            <div class="tax-assessment-amount">${{ homes[property_id].tax.property_assessed_value_amount | number }}</div>
                        </div>
                        {#
                        <div class="estimated-costs-section">
                            <div class="costs-header">Estimated Costs</div>
                            <div class="cost-item">
                                <div class="cost-label">Est. Taxes</div>
                                <div class="cost-amount">${{ homes[property_id].property.estimated_taxes | number }}</div>
                            </div>
                            <div class="cost-item">
                                <div class="cost-label">HOA Dues</div>
                                <div class="cost-amount">${{ homes[property_id].property.hoa_dues | number }}/mo</div>
                            </div>
                        </div>
                        #}
                    </div>

                    <button class="less-info-btn" onclick="toggleMoreInfo()">
                        <span>Less Info</span>
                        <img src="{{ 'uiicons-1.svg' | assetUrl }}" alt="Dropdown" class="dropdown-arrow rotated">
                    </button>
                </div>

                <!-- Service Providers Card -->
                <div class="providers-card" data-section="provider-cards">
                    <h3 class="providers-title">Hire top rated providers</h3>
                    <div class="providers-list">
                        {% if homes[property_id].service_providers %}
                        {% for provider in homes[property_id].service_providers %}
                        {% if loop.index == 1 %}
                        <div class="provider-item">
                            <div class="provider-avatar">
                                <img src="{{ 'annette.jpg' | assetUrl }}" alt="Annette Santiago">
                            </div>
                            <div class="provider-info">
                                <div class="provider-header">
                                    <img src="{{ 'type=real-estate-agent.svg' | assetUrl }}" alt="Provider icon" class="provider-icon">
                                    <span class="provider-name" data-tooltip="{{ provider.role }}">{{ provider.name }}</span>
                                </div>
                                <div class="provider-contact">
                                    <div class="phone-info">
                                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="phone-icon">
                                            <path d="M13.25 14C11.9611 14 10.6472 13.6889 9.30833 13.0667C7.96944 12.4444 6.72778 11.5611 5.58333 10.4167C4.43889 9.27222 3.55556 8.03056 2.93333 6.69167C2.31111 5.35278 2 4.03889 2 2.75C2 2.53567 2.07144 2.35711 2.21433 2.21433C2.35711 2.07144 2.53567 2 2.75 2H5.08333C5.23889 2 5.37222 2.05556 5.48333 2.16667C5.59444 2.27778 5.67222 2.41667 5.71667 2.58333L6.1655 4.67733C6.1885 4.83689 6.18611 4.98056 6.15833 5.10833C6.13056 5.23611 6.07094 5.34572 5.9795 5.43717L4.31667 7.11667C4.60556 7.60556 4.91111 8.06111 5.23333 8.48333C5.55556 8.90556 5.91111 9.30556 6.3 9.68333C6.71111 10.1056 7.14444 10.4917 7.6 10.8417C8.05556 11.1917 8.53333 11.5 9.03333 11.7667L10.6167 10.1333C10.7278 10.0111 10.8564 9.92778 11.0025 9.88333C11.1486 9.83889 11.2922 9.82778 11.4333 9.85L13.4167 10.2833C13.5833 10.3278 13.7222 10.4169 13.8333 10.5507C13.9444 10.6846 14 10.8343 14 11V13.25C14 13.4643 13.9286 13.6429 13.7857 13.7857C13.6429 13.9286 13.4643 14 13.25 14ZM3.81667 6.2L5.16667 4.83333L4.78333 3H3C3.02222 3.46667 3.09722 3.95833 3.225 4.475C3.35278 4.99167 3.55 5.56667 3.81667 6.2ZM9.96667 12.25C10.4222 12.4611 10.9167 12.6333 11.45 12.7667C11.9833 12.9 12.5 12.9778 13 13V11.2167L11.2833 10.8667L9.96667 12.25Z" fill="currentColor"/>
                                        </svg>
                                        <a href="tel:{{ provider.phone }}" class="phone-number">{{ provider.phone }}</a>
                                    </div>
                                    <button class="provider-more-info-btn" onclick="toggleProviderInfo(this)">
                                        <span>More Info</span>
                                        <img src="{{ 'type=carat-down.svg' | assetUrl }}" alt="Dropdown" class="provider-dropdown-arrow">
                                    </button>
                                </div>
                                <div class="provider-expanded-content" style="display: none;">
                                    <div class="provider-details">
                                            <div class="email-info">
                                            <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" class="email-icon">
                                              <path d="M9.36102 1.8977L15.0985 5.3402C15.2898 5.44145 15.4191 5.57926 15.4866 5.75363C15.5541 5.92801 15.5879 6.09957 15.5879 6.26832V14.0814C15.5879 14.3514 15.4866 14.5877 15.2841 14.7902C15.0816 14.9927 14.8454 15.0939 14.5754 15.0939H3.10039C2.83039 15.0939 2.59414 14.9927 2.39164 14.7902C2.18914 14.5877 2.08789 14.3514 2.08789 14.0814V6.26832C2.08789 6.09957 2.12445 5.92801 2.19758 5.75363C2.2707 5.57926 2.39727 5.44145 2.57727 5.3402L8.31477 1.8977C8.47767 1.8077 8.65339 1.7627 8.84194 1.7627C9.03049 1.7627 9.20352 1.8077 9.36102 1.8977ZM8.83789 9.4577L14.5079 6.13332L8.83789 2.72457L3.16789 6.13332L8.83789 9.4577ZM8.33164 10.2846L3.10039 7.21332V14.0814H14.5754V7.21332L9.34414 10.2846C9.1881 10.3746 9.01969 10.4196 8.8389 10.4196C8.65823 10.4196 8.48914 10.3746 8.33164 10.2846Z" fill="currentColor"/>
                                            </svg>
                                                <a href="mailto:Asantiagorealty@gmail.com" class="email-address">Asantiagorealty@gmail</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                        {% endfor %}
                        
                        <!-- Mobile expand button after first provider -->
                        <button class="view-all-providers-btn" onclick="toggleAllProviders(this)">
                            <span>View all providers</span>
                            <img src="{{ 'type=carat-down.svg' | assetUrl }}" alt="Expand" class="arrow">
                        </button>
                        
                        {% else %}
                        <!-- Default providers -->
                        
                        <!-- Provider 1: Real Estate Agent -->
                        <div class="provider-item">
                            <div class="provider-avatar">
                                <img src="{{ 'annette.jpg' | assetUrl }}" alt="Annette Santiago">
                            </div>
                            <div class="provider-info">
                                <div class="provider-header">
                                    <img src="{{ 'type=real-estate-agent.svg' | assetUrl }}" alt="Provider icon" class="provider-icon">
                                    <span class="provider-name" data-tooltip="Real Estate Agent">Annette Santiago</span>
                                </div>
                                <div class="provider-contact">
                                    <div class="phone-info">
                                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="phone-icon">
                                            <path d="M13.25 14C11.9611 14 10.6472 13.6889 9.30833 13.0667C7.96944 12.4444 6.72778 11.5611 5.58333 10.4167C4.43889 9.27222 3.55556 8.03056 2.93333 6.69167C2.31111 5.35278 2 4.03889 2 2.75C2 2.53567 2.07144 2.35711 2.21433 2.21433C2.35711 2.07144 2.53567 2 2.75 2H5.08333C5.23889 2 5.37222 2.05556 5.48333 2.16667C5.59444 2.27778 5.67222 2.41667 5.71667 2.58333L6.1655 4.67733C6.1885 4.83689 6.18611 4.98056 6.15833 5.10833C6.13056 5.23611 6.07094 5.34572 5.9795 5.43717L4.31667 7.11667C4.60556 7.60556 4.91111 8.06111 5.23333 8.48333C5.55556 8.90556 5.91111 9.30556 6.3 9.68333C6.71111 10.1056 7.14444 10.4917 7.6 10.8417C8.05556 11.1917 8.53333 11.5 9.03333 11.7667L10.6167 10.1333C10.7278 10.0111 10.8564 9.92778 11.0025 9.88333C11.1486 9.83889 11.2922 9.82778 11.4333 9.85L13.4167 10.2833C13.5833 10.3278 13.7222 10.4169 13.8333 10.5507C13.9444 10.6846 14 10.8343 14 11V13.25C14 13.4643 13.9286 13.6429 13.7857 13.7857C13.6429 13.9286 13.4643 14 13.25 14ZM3.81667 6.2L5.16667 4.83333L4.78333 3H3C3.02222 3.46667 3.09722 3.95833 3.225 4.475C3.35278 4.99167 3.55 5.56667 3.81667 6.2ZM9.96667 12.25C10.4222 12.4611 10.9167 12.6333 11.45 12.7667C11.9833 12.9 12.5 12.9778 13 13V11.2167L11.2833 10.8667L9.96667 12.25Z" fill="currentColor"/>
                                        </svg>
                                        <a href="tel:561-202-7707" class="phone-number">561-202-7707</a>
                                    </div>
                                    <button class="provider-more-info-btn" onclick="toggleProviderInfo(this)">
                                        <span>More Info</span>
                                        <img src="{{ 'type=carat-down.svg' | assetUrl }}" alt="Dropdown" class="provider-dropdown-arrow">
                                    </button>
                                </div>
                                <div class="provider-expanded-content" style="display: none;">
                                    <div class="provider-details">
                                        <div class="email-info">
                                            <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" class="email-icon">
                                              <path d="M9.36102 1.8977L15.0985 5.3402C15.2898 5.44145 15.4191 5.57926 15.4866 5.75363C15.5541 5.92801 15.5879 6.09957 15.5879 6.26832V14.0814C15.5879 14.3514 15.4866 14.5877 15.2841 14.7902C15.0816 14.9927 14.8454 15.0939 14.5754 15.0939H3.10039C2.83039 15.0939 2.59414 14.9927 2.39164 14.7902C2.18914 14.5877 2.08789 14.3514 2.08789 14.0814V6.26832C2.08789 6.09957 2.12445 5.92801 2.19758 5.75363C2.2707 5.57926 2.39727 5.44145 2.57727 5.3402L8.31477 1.8977C8.47767 1.8077 8.65339 1.7627 8.84194 1.7627C9.03049 1.7627 9.20352 1.8077 9.36102 1.8977ZM8.83789 9.4577L14.5079 6.13332L8.83789 2.72457L3.16789 6.13332L8.83789 9.4577ZM8.33164 10.2846L3.10039 7.21332V14.0814H14.5754V7.21332L9.34414 10.2846C9.1881 10.3746 9.01969 10.4196 8.8389 10.4196C8.65823 10.4196 8.48914 10.3746 8.33164 10.2846Z" fill="currentColor"/>
                                            </svg>
                                            <a href="mailto:asantiagorealty@gmail.com" class="email-address">asantiagorealty@gmail.com</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Mobile expand button after first provider -->
                        <button class="view-all-providers-btn" onclick="toggleAllProviders(this)">
                            <span>View all providers</span>
                            <img src="{{ 'type=carat-down.svg' | assetUrl }}" alt="Expand" class="arrow">
                        </button>

                        <!-- Provider 2: Home Inspector -->
                        <div class="provider-item">
                            <div class="provider-avatar">
                                <img src="{{ 'michael_headshot.png' | assetUrl }}" alt="Michael Johnson">
                            </div>
                            <div class="provider-info">
                                <div class="provider-header">
                                    <img src="{{ 'type=inspector.svg' | assetUrl }}" alt="Provider icon" class="provider-icon">
                                    <span class="provider-name" data-tooltip="Home Inspector">Michael Johnson</span>
                                </div>
                                <div class="provider-contact">
                                    <div class="phone-info">
                                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="phone-icon">
                                            <path d="M13.25 14C11.9611 14 10.6472 13.6889 9.30833 13.0667C7.96944 12.4444 6.72778 11.5611 5.58333 10.4167C4.43889 9.27222 3.55556 8.03056 2.93333 6.69167C2.31111 5.35278 2 4.03889 2 2.75C2 2.53567 2.07144 2.35711 2.21433 2.21433C2.35711 2.07144 2.53567 2 2.75 2H5.08333C5.23889 2 5.37222 2.05556 5.48333 2.16667C5.59444 2.27778 5.67222 2.41667 5.71667 2.58333L6.1655 4.67733C6.1885 4.83689 6.18611 4.98056 6.15833 5.10833C6.13056 5.23611 6.07094 5.34572 5.9795 5.43717L4.31667 7.11667C4.60556 7.60556 4.91111 8.06111 5.23333 8.48333C5.55556 8.90556 5.91111 9.30556 6.3 9.68333C6.71111 10.1056 7.14444 10.4917 7.6 10.8417C8.05556 11.1917 8.53333 11.5 9.03333 11.7667L10.6167 10.1333C10.7278 10.0111 10.8564 9.92778 11.0025 9.88333C11.1486 9.83889 11.2922 9.82778 11.4333 9.85L13.4167 10.2833C13.5833 10.3278 13.7222 10.4169 13.8333 10.5507C13.9444 10.6846 14 10.8343 14 11V13.25C14 13.4643 13.9286 13.6429 13.7857 13.7857C13.6429 13.9286 13.4643 14 13.25 14ZM3.81667 6.2L5.16667 4.83333L4.78333 3H3C3.02222 3.46667 3.09722 3.95833 3.225 4.475C3.35278 4.99167 3.55 5.56667 3.81667 6.2ZM9.96667 12.25C10.4222 12.4611 10.9167 12.6333 11.45 12.7667C11.9833 12.9 12.5 12.9778 13 13V11.2167L11.2833 10.8667L9.96667 12.25Z" fill="currentColor"/>
                                        </svg>
                                        <a href="tel:561-555-0123" class="phone-number">561-555-0123</a>
                                    </div>
                                    <button class="provider-more-info-btn" onclick="toggleProviderInfo(this)">
                                        <span>More Info</span>
                                        <img src="{{ 'type=carat-down.svg' | assetUrl }}" alt="Dropdown" class="provider-dropdown-arrow">
                                    </button>
                                </div>
                                <div class="provider-expanded-content" style="display: none;">
                                    <div class="provider-details">
                                        <div class="email-info">
                                            <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" class="email-icon">
                                              <path d="M9.36102 1.8977L15.0985 5.3402C15.2898 5.44145 15.4191 5.57926 15.4866 5.75363C15.5541 5.92801 15.5879 6.09957 15.5879 6.26832V14.0814C15.5879 14.3514 15.4866 14.5877 15.2841 14.7902C15.0816 14.9927 14.8454 15.0939 14.5754 15.0939H3.10039C2.83039 15.0939 2.59414 14.9927 2.39164 14.7902C2.18914 14.5877 2.08789 14.3514 2.08789 14.0814V6.26832C2.08789 6.09957 2.12445 5.92801 2.19758 5.75363C2.2707 5.57926 2.39727 5.44145 2.57727 5.3402L8.31477 1.8977C8.47767 1.8077 8.65339 1.7627 8.84194 1.7627C9.03049 1.7627 9.20352 1.8077 9.36102 1.8977ZM8.83789 9.4577L14.5079 6.13332L8.83789 2.72457L3.16789 6.13332L8.83789 9.4577ZM8.33164 10.2846L3.10039 7.21332V14.0814H14.5754V7.21332L9.34414 10.2846C9.1881 10.3746 9.01969 10.4196 8.8389 10.4196C8.65823 10.4196 8.48914 10.3746 8.33164 10.2846Z" fill="currentColor"/>
                                            </svg>
                                            <a href="mailto:michael@homeinspections.com" class="email-address">michael@homeinspections.com</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Provider 3: Mortgage Broker -->
                        <div class="provider-item">
                            <div class="provider-avatar">
                                <img src="{{ 'sarah_headshot.png' | assetUrl }}" alt="Sarah Williams">
                            </div>
                            <div class="provider-info">
                                <div class="provider-header">
                                    <img src="{{ 'type=mortgage-broker.svg' | assetUrl }}" alt="Provider icon" class="provider-icon">
                                    <span class="provider-name" data-tooltip="Mortgage Broker">Sarah Williams</span>
                                </div>
                                <div class="provider-contact">
                                    <div class="phone-info">
                                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="phone-icon">
                                            <path d="M13.25 14C11.9611 14 10.6472 13.6889 9.30833 13.0667C7.96944 12.4444 6.72778 11.5611 5.58333 10.4167C4.43889 9.27222 3.55556 8.03056 2.93333 6.69167C2.31111 5.35278 2 4.03889 2 2.75C2 2.53567 2.07144 2.35711 2.21433 2.21433C2.35711 2.07144 2.53567 2 2.75 2H5.08333C5.23889 2 5.37222 2.05556 5.48333 2.16667C5.59444 2.27778 5.67222 2.41667 5.71667 2.58333L6.1655 4.67733C6.1885 4.83689 6.18611 4.98056 6.15833 5.10833C6.13056 5.23611 6.07094 5.34572 5.9795 5.43717L4.31667 7.11667C4.60556 7.60556 4.91111 8.06111 5.23333 8.48333C5.55556 8.90556 5.91111 9.30556 6.3 9.68333C6.71111 10.1056 7.14444 10.4917 7.6 10.8417C8.05556 11.1917 8.53333 11.5 9.03333 11.7667L10.6167 10.1333C10.7278 10.0111 10.8564 9.92778 11.0025 9.88333C11.1486 9.83889 11.2922 9.82778 11.4333 9.85L13.4167 10.2833C13.5833 10.3278 13.7222 10.4169 13.8333 10.5507C13.9444 10.6846 14 10.8343 14 11V13.25C14 13.4643 13.9286 13.6429 13.7857 13.7857C13.6429 13.9286 13.4643 14 13.25 14ZM3.81667 6.2L5.16667 4.83333L4.78333 3H3C3.02222 3.46667 3.09722 3.95833 3.225 4.475C3.35278 4.99167 3.55 5.56667 3.81667 6.2ZM9.96667 12.25C10.4222 12.4611 10.9167 12.6333 11.45 12.7667C11.9833 12.9 12.5 12.9778 13 13V11.2167L11.2833 10.8667L9.96667 12.25Z" fill="currentColor"/>
                                        </svg>
                                        <a href="tel:561-555-0456" class="phone-number">561-555-0456</a>
                                    </div>
                                    <button class="provider-more-info-btn" onclick="toggleProviderInfo(this)">
                                        <span>More Info</span>
                                        <img src="{{ 'type=carat-down.svg' | assetUrl }}" alt="Dropdown" class="provider-dropdown-arrow">
                                    </button>
                                </div>
                                <div class="provider-expanded-content" style="display: none;">
                                    <div class="provider-details">
                                        <div class="email-info">
                                            <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" class="email-icon">
                                              <path d="M9.36102 1.8977L15.0985 5.3402C15.2898 5.44145 15.4191 5.57926 15.4866 5.75363C15.5541 5.92801 15.5879 6.09957 15.5879 6.26832V14.0814C15.5879 14.3514 15.4866 14.5877 15.2841 14.7902C15.0816 14.9927 14.8454 15.0939 14.5754 15.0939H3.10039C2.83039 15.0939 2.59414 14.9927 2.39164 14.7902C2.18914 14.5877 2.08789 14.3514 2.08789 14.0814V6.26832C2.08789 6.09957 2.12445 5.92801 2.19758 5.75363C2.2707 5.57926 2.39727 5.44145 2.57727 5.3402L8.31477 1.8977C8.47767 1.8077 8.65339 1.7627 8.84194 1.7627C9.03049 1.7627 9.20352 1.8077 9.36102 1.8977ZM8.83789 9.4577L14.5079 6.13332L8.83789 2.72457L3.16789 6.13332L8.83789 9.4577ZM8.33164 10.2846L3.10039 7.21332V14.0814H14.5754V7.21332L9.34414 10.2846C9.1881 10.3746 9.01969 10.4196 8.8389 10.4196C8.65823 10.4196 8.48914 10.3746 8.33164 10.2846Z" fill="currentColor"/>
                                            </svg>
                                            <a href="mailto:sarah@mortgageexperts.com" class="email-address">sarah@mortgageexperts.com</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Provider 4: Appraiser -->
                        <div class="provider-item">
                            <div class="provider-avatar">
                                <img src="{{ 'david_headshot.png' | assetUrl }}" alt="David Rodriguez">
                            </div>
                            <div class="provider-info">
                                <div class="provider-header">
                                    <img src="{{ 'type=appraiser.svg' | assetUrl }}" alt="Provider icon" class="provider-icon">
                                    <span class="provider-name" data-tooltip="Licensed Appraiser">David Rodriguez</span>
                                </div>
                                <div class="provider-contact">
                                    <div class="phone-info">
                                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="phone-icon">
                                            <path d="M13.25 14C11.9611 14 10.6472 13.6889 9.30833 13.0667C7.96944 12.4444 6.72778 11.5611 5.58333 10.4167C4.43889 9.27222 3.55556 8.03056 2.93333 6.69167C2.31111 5.35278 2 4.03889 2 2.75C2 2.53567 2.07144 2.35711 2.21433 2.21433C2.35711 2.07144 2.53567 2 2.75 2H5.08333C5.23889 2 5.37222 2.05556 5.48333 2.16667C5.59444 2.27778 5.67222 2.41667 5.71667 2.58333L6.1655 4.67733C6.1885 4.83689 6.18611 4.98056 6.15833 5.10833C6.13056 5.23611 6.07094 5.34572 5.9795 5.43717L4.31667 7.11667C4.60556 7.60556 4.91111 8.06111 5.23333 8.48333C5.55556 8.90556 5.91111 9.30556 6.3 9.68333C6.71111 10.1056 7.14444 10.4917 7.6 10.8417C8.05556 11.1917 8.53333 11.5 9.03333 11.7667L10.6167 10.1333C10.7278 10.0111 10.8564 9.92778 11.0025 9.88333C11.1486 9.83889 11.2922 9.82778 11.4333 9.85L13.4167 10.2833C13.5833 10.3278 13.7222 10.4169 13.8333 10.5507C13.9444 10.6846 14 10.8343 14 11V13.25C14 13.4643 13.9286 13.6429 13.7857 13.7857C13.6429 13.9286 13.4643 14 13.25 14ZM3.81667 6.2L5.16667 4.83333L4.78333 3H3C3.02222 3.46667 3.09722 3.95833 3.225 4.475C3.35278 4.99167 3.55 5.56667 3.81667 6.2ZM9.96667 12.25C10.4222 12.4611 10.9167 12.6333 11.45 12.7667C11.9833 12.9 12.5 12.9778 13 13V11.2167L11.2833 10.8667L9.96667 12.25Z" fill="currentColor"/>
                                        </svg>
                                        <a href="tel:561-555-0789" class="phone-number">561-555-0789</a>
                                    </div>
                                    <button class="provider-more-info-btn" onclick="toggleProviderInfo(this)">
                                        <span>More Info</span>
                                        <img src="{{ 'type=carat-down.svg' | assetUrl }}" alt="Dropdown" class="provider-dropdown-arrow">
                                    </button>
                                </div>
                                <div class="provider-expanded-content" style="display: none;">
                                    <div class="provider-details">
                                        <div class="email-info">
                                            <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" class="email-icon">
                                              <path d="M9.36102 1.8977L15.0985 5.3402C15.2898 5.44145 15.4191 5.57926 15.4866 5.75363C15.5541 5.92801 15.5879 6.09957 15.5879 6.26832V14.0814C15.5879 14.3514 15.4866 14.5877 15.2841 14.7902C15.0816 14.9927 14.8454 15.0939 14.5754 15.0939H3.10039C2.83039 15.0939 2.59414 14.9927 2.39164 14.7902C2.18914 14.5877 2.08789 14.3514 2.08789 14.0814V6.26832C2.08789 6.09957 2.12445 5.92801 2.19758 5.75363C2.2707 5.57926 2.39727 5.44145 2.57727 5.3402L8.31477 1.8977C8.47767 1.8077 8.65339 1.7627 8.84194 1.7627C9.03049 1.7627 9.20352 1.8077 9.36102 1.8977ZM8.83789 9.4577L14.5079 6.13332L8.83789 2.72457L3.16789 6.13332L8.83789 9.4577ZM8.33164 10.2846L3.10039 7.21332V14.0814H14.5754V7.21332L9.34414 10.2846C9.1881 10.3746 9.01969 10.4196 8.8389 10.4196C8.65823 10.4196 8.48914 10.3746 8.33164 10.2846Z" fill="currentColor"/>
                                            </svg>
                                            <a href="mailto:david@propertyappraisals.com" class="email-address">david@propertyappraisals.com</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Provider 5: Title Agent -->
                        <div class="provider-item">
                            <div class="provider-avatar">
                                <img src="{{ 'jennifer_headshot.png' | assetUrl }}" alt="Jennifer Chen">
                            </div>
                            <div class="provider-info">
                                <div class="provider-header">
                                    <img src="{{ 'type=title-agent.svg' | assetUrl }}" alt="Provider icon" class="provider-icon">
                                    <span class="provider-name" data-tooltip="Title Agent">Jennifer Chen</span>
                                </div>
                                <div class="provider-contact">
                                    <div class="phone-info">
                                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="phone-icon">
                                            <path d="M13.25 14C11.9611 14 10.6472 13.6889 9.30833 13.0667C7.96944 12.4444 6.72778 11.5611 5.58333 10.4167C4.43889 9.27222 3.55556 8.03056 2.93333 6.69167C2.31111 5.35278 2 4.03889 2 2.75C2 2.53567 2.07144 2.35711 2.21433 2.21433C2.35711 2.07144 2.53567 2 2.75 2H5.08333C5.23889 2 5.37222 2.05556 5.48333 2.16667C5.59444 2.27778 5.67222 2.41667 5.71667 2.58333L6.1655 4.67733C6.1885 4.83689 6.18611 4.98056 6.15833 5.10833C6.13056 5.23611 6.07094 5.34572 5.9795 5.43717L4.31667 7.11667C4.60556 7.60556 4.91111 8.06111 5.23333 8.48333C5.55556 8.90556 5.91111 9.30556 6.3 9.68333C6.71111 10.1056 7.14444 10.4917 7.6 10.8417C8.05556 11.1917 8.53333 11.5 9.03333 11.7667L10.6167 10.1333C10.7278 10.0111 10.8564 9.92778 11.0025 9.88333C11.1486 9.83889 11.2922 9.82778 11.4333 9.85L13.4167 10.2833C13.5833 10.3278 13.7222 10.4169 13.8333 10.5507C13.9444 10.6846 14 10.8343 14 11V13.25C14 13.4643 13.9286 13.6429 13.7857 13.7857C13.6429 13.9286 13.4643 14 13.25 14ZM3.81667 6.2L5.16667 4.83333L4.78333 3H3C3.02222 3.46667 3.09722 3.95833 3.225 4.475C3.35278 4.99167 3.55 5.56667 3.81667 6.2ZM9.96667 12.25C10.4222 12.4611 10.9167 12.6333 11.45 12.7667C11.9833 12.9 12.5 12.9778 13 13V11.2167L11.2833 10.8667L9.96667 12.25Z" fill="currentColor"/>
                                        </svg>
                                        <a href="tel:561-555-0321" class="phone-number">561-555-0321</a>
                                    </div>
                                    <button class="provider-more-info-btn" onclick="toggleProviderInfo(this)">
                                        <span>More Info</span>
                                        <img src="{{ 'type=carat-down.svg' | assetUrl }}" alt="Dropdown" class="provider-dropdown-arrow">
                                    </button>
                                </div>
                                <div class="provider-expanded-content" style="display: none;">
                                    <div class="provider-details">
                                        <div class="email-info">
                                            <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" class="email-icon">
                                              <path d="M9.36102 1.8977L15.0985 5.3402C15.2898 5.44145 15.4191 5.57926 15.4866 5.75363C15.5541 5.92801 15.5879 6.09957 15.5879 6.26832V14.0814C15.5879 14.3514 15.4866 14.5877 15.2841 14.7902C15.0816 14.9927 14.8454 15.0939 14.5754 15.0939H3.10039C2.83039 15.0939 2.59414 14.9927 2.39164 14.7902C2.18914 14.5877 2.08789 14.3514 2.08789 14.0814V6.26832C2.08789 6.09957 2.12445 5.92801 2.19758 5.75363C2.2707 5.57926 2.39727 5.44145 2.57727 5.3402L8.31477 1.8977C8.47767 1.8077 8.65339 1.7627 8.84194 1.7627C9.03049 1.7627 9.20352 1.8077 9.36102 1.8977ZM8.83789 9.4577L14.5079 6.13332L8.83789 2.72457L3.16789 6.13332L8.83789 9.4577ZM8.33164 10.2846L3.10039 7.21332V14.0814H14.5754V7.21332L9.34414 10.2846C9.1881 10.3746 9.01969 10.4196 8.8389 10.4196C8.65823 10.4196 8.48914 10.3746 8.33164 10.2846Z" fill="currentColor"/>
                                            </svg>
                                            <a href="mailto:jennifer@titleservices.com" class="email-address">jennifer@titleservices.com</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Provider 6: Insurance Broker -->
                        <div class="provider-item">
                            <div class="provider-avatar">
                                <img src="{{ 'robert_headshot.png' | assetUrl }}" alt="Robert Thompson">
                            </div>
                            <div class="provider-info">
                                <div class="provider-header">
                                    <img src="{{ 'type=insurance-broker.svg' | assetUrl }}" alt="Provider icon" class="provider-icon">
                                    <span class="provider-name" data-tooltip="Insurance Broker">Robert Thompson</span>
                                </div>
                                <div class="provider-contact">
                                    <div class="phone-info">
                                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="phone-icon">
                                            <path d="M13.25 14C11.9611 14 10.6472 13.6889 9.30833 13.0667C7.96944 12.4444 6.72778 11.5611 5.58333 10.4167C4.43889 9.27222 3.55556 8.03056 2.93333 6.69167C2.31111 5.35278 2 4.03889 2 2.75C2 2.53567 2.07144 2.35711 2.21433 2.21433C2.35711 2.07144 2.53567 2 2.75 2H5.08333C5.23889 2 5.37222 2.05556 5.48333 2.16667C5.59444 2.27778 5.67222 2.41667 5.71667 2.58333L6.1655 4.67733C6.1885 4.83689 6.18611 4.98056 6.15833 5.10833C6.13056 5.23611 6.07094 5.34572 5.9795 5.43717L4.31667 7.11667C4.60556 7.60556 4.91111 8.06111 5.23333 8.48333C5.55556 8.90556 5.91111 9.30556 6.3 9.68333C6.71111 10.1056 7.14444 10.4917 7.6 10.8417C8.05556 11.1917 8.53333 11.5 9.03333 11.7667L10.6167 10.1333C10.7278 10.0111 10.8564 9.92778 11.0025 9.88333C11.1486 9.83889 11.2922 9.82778 11.4333 9.85L13.4167 10.2833C13.5833 10.3278 13.7222 10.4169 13.8333 10.5507C13.9444 10.6846 14 10.8343 14 11V13.25C14 13.4643 13.9286 13.6429 13.7857 13.7857C13.6429 13.9286 13.4643 14 13.25 14ZM3.81667 6.2L5.16667 4.83333L4.78333 3H3C3.02222 3.46667 3.09722 3.95833 3.225 4.475C3.35278 4.99167 3.55 5.56667 3.81667 6.2ZM9.96667 12.25C10.4222 12.4611 10.9167 12.6333 11.45 12.7667C11.9833 12.9 12.5 12.9778 13 13V11.2167L11.2833 10.8667L9.96667 12.25Z" fill="currentColor"/>
                                        </svg>
                                        <a href="tel:561-555-0654" class="phone-number">561-555-0654</a>
                                    </div>
                                    <button class="provider-more-info-btn" onclick="toggleProviderInfo(this)">
                                        <span>More Info</span>
                                        <img src="{{ 'type=carat-down.svg' | assetUrl }}" alt="Dropdown" class="provider-dropdown-arrow">
                                    </button>
                                </div>
                                <div class="provider-expanded-content" style="display: none;">
                                    <div class="provider-details">
                                        <div class="email-info">
                                            <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" class="email-icon">
                                              <path d="M9.36102 1.8977L15.0985 5.3402C15.2898 5.44145 15.4191 5.57926 15.4866 5.75363C15.5541 5.92801 15.5879 6.09957 15.5879 6.26832V14.0814C15.5879 14.3514 15.4866 14.5877 15.2841 14.7902C15.0816 14.9927 14.8454 15.0939 14.5754 15.0939H3.10039C2.83039 15.0939 2.59414 14.9927 2.39164 14.7902C2.18914 14.5877 2.08789 14.3514 2.08789 14.0814V6.26832C2.08789 6.09957 2.12445 5.92801 2.19758 5.75363C2.2707 5.57926 2.39727 5.44145 2.57727 5.3402L8.31477 1.8977C8.47767 1.8077 8.65339 1.7627 8.84194 1.7627C9.03049 1.7627 9.20352 1.8077 9.36102 1.8977ZM8.83789 9.4577L14.5079 6.13332L8.83789 2.72457L3.16789 6.13332L8.83789 9.4577ZM8.33164 10.2846L3.10039 7.21332V14.0814H14.5754V7.21332L9.34414 10.2846C9.1881 10.3746 9.01969 10.4196 8.8389 10.4196C8.65823 10.4196 8.48914 10.3746 8.33164 10.2846Z" fill="currentColor"/>
                                            </svg>
                                            <a href="mailto:robert@insuranceexperts.com" class="email-address">robert@insuranceexperts.com</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Provider 7: Photographer -->
                        <div class="provider-item">
                            <div class="provider-avatar">
                                <img src="{{ 'lisa_headshot.png' | assetUrl }}" alt="Lisa Martinez">
                            </div>
                            <div class="provider-info">
                                <div class="provider-header">
                                    <img src="{{ 'type=photographer.svg' | assetUrl }}" alt="Provider icon" class="provider-icon">
                                    <span class="provider-name" data-tooltip="Real Estate Photographer">Lisa Martinez</span>
                                </div>
                                <div class="provider-contact">
                                    <div class="phone-info">
                                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="phone-icon">
                                            <path d="M13.25 14C11.9611 14 10.6472 13.6889 9.30833 13.0667C7.96944 12.4444 6.72778 11.5611 5.58333 10.4167C4.43889 9.27222 3.55556 8.03056 2.93333 6.69167C2.31111 5.35278 2 4.03889 2 2.75C2 2.53567 2.07144 2.35711 2.21433 2.21433C2.35711 2.07144 2.53567 2 2.75 2H5.08333C5.23889 2 5.37222 2.05556 5.48333 2.16667C5.59444 2.27778 5.67222 2.41667 5.71667 2.58333L6.1655 4.67733C6.1885 4.83689 6.18611 4.98056 6.15833 5.10833C6.13056 5.23611 6.07094 5.34572 5.9795 5.43717L4.31667 7.11667C4.60556 7.60556 4.91111 8.06111 5.23333 8.48333C5.55556 8.90556 5.91111 9.30556 6.3 9.68333C6.71111 10.1056 7.14444 10.4917 7.6 10.8417C8.05556 11.1917 8.53333 11.5 9.03333 11.7667L10.6167 10.1333C10.7278 10.0111 10.8564 9.92778 11.0025 9.88333C11.1486 9.83889 11.2922 9.82778 11.4333 9.85L13.4167 10.2833C13.5833 10.3278 13.7222 10.4169 13.8333 10.5507C13.9444 10.6846 14 10.8343 14 11V13.25C14 13.4643 13.9286 13.6429 13.7857 13.7857C13.6429 13.9286 13.4643 14 13.25 14ZM3.81667 6.2L5.16667 4.83333L4.78333 3H3C3.02222 3.46667 3.09722 3.95833 3.225 4.475C3.35278 4.99167 3.55 5.56667 3.81667 6.2ZM9.96667 12.25C10.4222 12.4611 10.9167 12.6333 11.45 12.7667C11.9833 12.9 12.5 12.9778 13 13V11.2167L11.2833 10.8667L9.96667 12.25Z" fill="currentColor"/>
                                        </svg>
                                        <a href="tel:561-555-0987" class="phone-number">561-555-0987</a>
                                    </div>
                                    <button class="provider-more-info-btn" onclick="toggleProviderInfo(this)">
                                        <span>More Info</span>
                                        <img src="{{ 'type=carat-down.svg' | assetUrl }}" alt="Dropdown" class="provider-dropdown-arrow">
                                    </button>
                                </div>
                                <div class="provider-expanded-content" style="display: none;">
                                    <div class="provider-details">
                                        <div class="email-info">
                                            <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" class="email-icon">
                                              <path d="M9.36102 1.8977L15.0985 5.3402C15.2898 5.44145 15.4191 5.57926 15.4866 5.75363C15.5541 5.92801 15.5879 6.09957 15.5879 6.26832V14.0814C15.5879 14.3514 15.4866 14.5877 15.2841 14.7902C15.0816 14.9927 14.8454 15.0939 14.5754 15.0939H3.10039C2.83039 15.0939 2.59414 14.9927 2.39164 14.7902C2.18914 14.5877 2.08789 14.3514 2.08789 14.0814V6.26832C2.08789 6.09957 2.12445 5.92801 2.19758 5.75363C2.2707 5.57926 2.39727 5.44145 2.57727 5.3402L8.31477 1.8977C8.47767 1.8077 8.65339 1.7627 8.84194 1.7627C9.03049 1.7627 9.20352 1.8077 9.36102 1.8977ZM8.83789 9.4577L14.5079 6.13332L8.83789 2.72457L3.16789 6.13332L8.83789 9.4577ZM8.33164 10.2846L3.10039 7.21332V14.0814H14.5754V7.21332L9.34414 10.2846C9.1881 10.3746 9.01969 10.4196 8.8389 10.4196C8.65823 10.4196 8.48914 10.3746 8.33164 10.2846Z" fill="currentColor"/>
                                            </svg>
                                            <a href="mailto:lisa@propertyphotos.com" class="email-address">lisa@propertyphotos.com</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>


                        <!-- Mobile collapse button at bottom (only shows when expanded) -->
                        <button class="view-less-providers-btn" onclick="toggleAllProviders(this)">
                            <span>View less</span>
                            <img src="{{ 'type=carat-down.svg' | assetUrl }}" alt="Collapse" class="arrow">
                        </button>
                        
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
                    <div class="property-divider" data-section="property-divider"></div>
    <div id="datasrc" class="data-footnotes">
      <div class="data-source-btn-row" style="font-size:12px; color:#8E8B8B; padding-left:0;">
        {% if homes[property_id].address.source_http_request %}
        <a id="addresssrc" href="https://pbcpao.gov/Property/Details?parcelId={{ property_id }}" target="_blank" rel="noopener noreferrer" class="data-source-btn" tabindex="-1">View Address Data Source</a>
        {% endif %}

        {% if homes[property_id].property.sourceUrl %}
          <a href="{{ homes[property_id].property.sourceUrl }}" target="_blank" rel="noopener noreferrer" class="data-source-btn">View County Data Source</a>
        {% endif %}
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% if config.inlineJs %}
<!-- JS is inlined -->
{% else %}
<script src="{{ 'js/property.js' | assetUrl }}"></script>
{% endif %}
<script>
  document.addEventListener('DOMContentLoaded',()=>{
    if(location.hash){
      const el=document.querySelector(location.hash);
      if(el){
        el.focus();
      }
    }
    
    // Auto-hide navigation when main-content doesn't exceed viewport
    checkNavigationVisibility();
  });

  // Check if navigation should be hidden based on main-content height
  function checkNavigationVisibility() {
    const navigation = document.querySelector('.navigation');
    const mainContent = document.querySelector('.main-content');
    
    if (!mainContent) return;
    
    const mainContentHeight = mainContent.offsetHeight;
    const viewportHeight = window.innerHeight;
    
    if (mainContentHeight <= viewportHeight) {
      // Main content fits in viewport, hide navigation
      navigation.classList.add('auto-hide');
    } else {
      // Main content exceeds viewport, show navigation
      navigation.classList.remove('auto-hide');
    }
  }
  
  // Recheck on window resize
  window.addEventListener('resize', checkNavigationVisibility);

  function toggleRoomDetails(header) {
    const roomItem = header.parentElement;
    const properties = roomItem.querySelector('.room-properties');
    const expandIcon = header.querySelector('.room-expand-icon');
    
    // Check if this room is currently open
    const isCurrentlyOpen = properties.style.display === 'flex' || properties.style.display === 'block';
    
    // Close all room dropdowns first
    const allRoomProperties = document.querySelectorAll('.room-properties');
    const allExpandIcons = document.querySelectorAll('.room-expand-icon');
    
    allRoomProperties.forEach(roomProps => {
      roomProps.style.display = 'none';
    });
    
    allExpandIcons.forEach(icon => {
      icon.style.transform = 'rotate(0deg)';
    });
    
    // If the clicked room was closed, open it
    if (!isCurrentlyOpen) {
      properties.style.display = 'flex';
      expandIcon.style.transform = 'rotate(180deg)';
    }
  }

  function getCurrentSlide(propertyId) {
    const radioButtons = document.querySelectorAll(`input[name="carousel-radio-${propertyId}"]`);
    for (let i = 0; i < radioButtons.length; i++) {
      if (radioButtons[i].checked) {
        return i;
      }
    }
    return 0;
  }

  function setSlide(propertyId, index) {
    const radioButtons = document.querySelectorAll(`input[name="carousel-radio-${propertyId}"]`);
    if (radioButtons[index]) {
      radioButtons[index].checked = true;
    }
  }

  function nextSlide(propertyId) {
    const radioButtons = document.querySelectorAll(`input[name="carousel-radio-${propertyId}"]`);
    const currentIndex = getCurrentSlide(propertyId);
    const nextIndex = (currentIndex + 1) % radioButtons.length;
    setSlide(propertyId, nextIndex);
  }

  function previousSlide(propertyId) {
    const radioButtons = document.querySelectorAll(`input[name="carousel-radio-${propertyId}"]`);
    const currentIndex = getCurrentSlide(propertyId);
    const prevIndex = currentIndex === 0 ? radioButtons.length - 1 : currentIndex - 1;
    setSlide(propertyId, prevIndex);
  }

  function toggleAllProviders(button) {
    const providersList = button.closest('.providers-list');
    
    if (providersList.classList.contains('mobile-expanded')) {
      // Currently expanded, so collapse
      providersList.classList.remove('mobile-expanded');
    } else {
      // Currently collapsed, so expand
      providersList.classList.add('mobile-expanded');
    }
  }

  // Handle building details grid gap when second column is empty
  function handleBuildingDetailsGap() {
    const buildingDetailsGrids = document.querySelectorAll('.building-details-grid');
    
    buildingDetailsGrids.forEach(grid => {
      const secondColumn = grid.querySelector('.building-details-column:nth-child(2)');
      if (secondColumn) {
        const hasItems = secondColumn.querySelector('.building-spec-item');
        if (!hasItems) {
          grid.classList.add('single-column');
        }
      }
    });
  }

  // Run on page load
  document.addEventListener('DOMContentLoaded', handleBuildingDetailsGap);
</script>
{% endset %}
